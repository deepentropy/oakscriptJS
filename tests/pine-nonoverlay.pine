//@version=6
indicator(title="OakScript Reference - Oscillators & Non-Overlay", shorttitle="OakRef-Oscillators", overlay=false)

// === INPUTS ===
length = input.int(14, "Length", minval=1)
source = input.source(close, "Source")
fast_length = input.int(12, "Fast Length", minval=1)
slow_length = input.int(26, "Slow Length", minval=1)
signal_length = input.int(9, "Signal Length", minval=1)

// === MOMENTUM OSCILLATORS ===

// RSI
rsi_val = ta.rsi(source, length)

// Stochastic
stoch_k = ta.stoch(close, high, low, length)
stoch_d = ta.sma(stoch_k, 3)

// Stochastic RSI
rsi_for_stoch = ta.rsi(source, length)
stoch_rsi_k = ta.stoch(rsi_for_stoch, rsi_for_stoch, rsi_for_stoch, length)
stoch_rsi_d = ta. sma(stoch_rsi_k, 3)

// MACD
[macd_line, signal_line, macd_hist] = ta.macd(source, fast_length, slow_length, signal_length)

// CCI (Commodity Channel Index)
cci_val = ta.cci(hlc3, length)

// Williams %R
williams_r = ta.percentrank(close, length) - 100

// Momentum
mom_val = source - source[length]

// Rate of Change (ROC)
roc_val = 100 * (source - source[length]) / source[length]

// ROC with MA
roc_ma = ta.sma(roc_val, 9)

// Awesome Oscillator
ao_val = ta. sma(hl2, 5) - ta.sma(hl2, 34)

// Accelerator Oscillator
ac_val = ao_val - ta.sma(ao_val, 5)

// Ultimate Oscillator
bp = close - math.min(low, close[1])
tr_uo = math.max(high, close[1]) - math. min(low, close[1])
avg7 = ta.sma(bp, 7) / ta.sma(tr_uo, 7)
avg14 = ta. sma(bp, 14) / ta.sma(tr_uo, 14)
avg28 = ta.sma(bp, 28) / ta. sma(tr_uo, 28)
uo_val = 100 * (4 * avg7 + 2 * avg14 + avg28) / 7

// === TREND INDICATORS ===

// ADX (Average Directional Index)
[di_plus, di_minus, adx_val] = ta. dmi(length, length)

// Aroon
aroon_up = 100 * (ta.highestbars(high, length + 1) + length) / length
aroon_down = 100 * (ta.lowestbars(low, length + 1) + length) / length
aroon_osc = aroon_up - aroon_down

// === VOLATILITY INDICATORS ===

// ATR (Average True Range)
atr_val = ta.atr(length)

// Normalized ATR (as percentage)
natr_val = 100 * atr_val / close

// True Range
tr_val = ta.tr(true)

// Bollinger Band Width
bb_basis = ta.sma(source, length)
bb_dev = ta.stdev(source, length)
bb_width = (2 * bb_dev) / bb_basis * 100

// Bollinger %B
bb_upper = bb_basis + 2 * bb_dev
bb_lower = bb_basis - 2 * bb_dev
percent_b = (source - bb_lower) / (bb_upper - bb_lower) * 100

// Standard Deviation
stdev_val = ta.stdev(source, length)

// Historical Volatility
hv_val = ta.stdev(math.log(close / close[1]), length) * math.sqrt(252) * 100

// Chaikin Volatility
ema_hl = ta.ema(high - low, length)
chaikin_vol = (ema_hl - ema_hl[length]) / ema_hl[length] * 100

// === VOLUME INDICATORS ===

// OBV (On Balance Volume)
obv_val = ta. obv

// Accumulation/Distribution
ad_val = ta.cum(((close - low) - (high - close)) / (high - low) * volume)

// Chaikin Money Flow
mfv = ((close - low) - (high - close)) / (high - low) * volume
cmf_val = ta.sma(mfv, length) / ta.sma(volume, length)

// Money Flow Index
mfi_val = ta.mfi(hlc3, length)

// Volume Weighted Average Price (intraday proxy)
vwap_proxy = ta.cum(hlc3 * volume) / ta.cum(volume)

// Force Index
force_index = ta.ema((close - close[1]) * volume, length)

// Ease of Movement
emv = (high + low) / 2 - (high[1] + low[1]) / 2
emv_val = ta.sma(emv / (volume / 10000) / (high - low), length)

// === BALANCE/STRENGTH INDICATORS ===

// Balance of Power
bop_val = (close - open) / (high - low)
bop_sma = ta.sma(bop_val, length)

// Elder's Force Index
efi_val = ta.ema((close - close[1]) * volume, 13)

// Mass Index
ema_range = ta.ema(high - low, 9)
ema_ema_range = ta.ema(ema_range, 9)
mass_index = math.sum(ema_range / ema_ema_range, 25)

// Average Day Range
adr_val = ta.sma(high - low, length)

// Coppock Curve
roc1 = ta.roc(source, 14)
roc2 = ta.roc(source, 11)
coppock = ta.wma(roc1 + roc2, 10)

// Trix
ema1 = ta.ema(source, length)
ema2 = ta.ema(ema1, length)
ema3 = ta.ema(ema2, length)
trix_val = 100 * (ema3 - ema3[1]) / ema3[1]

// Know Sure Thing (KST)
roc1_kst = ta.roc(source, 10)
roc2_kst = ta.roc(source, 15)
roc3_kst = ta.roc(source, 20)
roc4_kst = ta.roc(source, 30)
kst_val = ta.sma(roc1_kst, 10) + 2 * ta. sma(roc2_kst, 10) + 3 * ta. sma(roc3_kst, 10) + 4 * ta. sma(roc4_kst, 15)
kst_signal = ta.sma(kst_val, 9)

// Relative Vigor Index
rvi_num = ta.sma(close - open, 4)
rvi_den = ta.sma(high - low, 4)
rvi_val = ta.sma(rvi_num, length) / ta.sma(rvi_den, length)
rvi_signal = ta.sma(rvi_val, 4)

// === PLOTS ===

// Main oscillators (always visible)
plot(rsi_val, "RSI", color=color.purple, linewidth=2)
hline(70, "RSI Overbought", color=color.red, linestyle=hline.style_dashed)
hline(30, "RSI Oversold", color=color.green, linestyle=hline.style_dashed)
hline(50, "RSI Mid", color=color. gray, linestyle=hline.style_dotted)

// Stochastic
plot(stoch_k, "Stoch %K", color=color.blue)
plot(stoch_d, "Stoch %D", color=color.orange, display=display. none)

// MACD
plot(macd_line, "MACD", color=color.blue)
plot(signal_line, "Signal", color=color.orange, display=display. none)
plot(macd_hist, "Histogram", color=color.gray, style=plot.style_histogram, display=display. none)

// CCI
plot(cci_val, "CCI", color=color.teal)

// Momentum & ROC
plot(mom_val, "Momentum", color=color.lime, display=display. none)
plot(roc_val, "ROC", color=color.yellow, display=display. none)
plot(roc_ma, "ROC MA", color=color.orange, display=display. none)

// Awesome/Accelerator
plot(ao_val, "Awesome Osc", color=color.green, display=display. none)
plot(ac_val, "Accelerator Osc", color=color.red)

// Ultimate Oscillator
plot(uo_val, "Ultimate Osc", color=color.fuchsia)

// ADX
plot(adx_val, "ADX", color=color.orange, display=display. none)
plot(di_plus, "DI+", color=color.green, display=display. none)
plot(di_minus, "DI-", color=color.red)

// Aroon
plot(aroon_up, "Aroon Up", color=color.green, display=display. none)
plot(aroon_down, "Aroon Down", color=color. red)
plot(aroon_osc, "Aroon Osc", color=color. blue, display=display. none)

// Volatility
plot(atr_val, "ATR", color=color.orange, display=display. none)
plot(natr_val, "NATR %", color=color. yellow, display=display. none)
plot(bb_width, "BB Width", color=color.blue, display=display. none)
plot(percent_b, "BB %B", color=color.purple, display=display. none)
plot(stdev_val, "StdDev", color=color.gray)
plot(hv_val, "Hist Vol", color=color.red)

// Volume
plot(obv_val, "OBV", color=color.blue, display=display. none)
plot(ad_val, "A/D", color=color.green)
plot(cmf_val, "CMF", color=color.teal)
plot(mfi_val, "MFI", color=color. purple, display=display. none)
plot(force_index, "Force Index", color=color.red)

// Balance/Strength
plot(bop_val, "BOP", color=color.blue, display=display. none)
plot(bop_sma, "BOP SMA", color=color. orange, display=display. none)
plot(mass_index, "Mass Index", color=color.purple, display=display. none)
plot(adr_val, "ADR", color=color.green, display=display. none)
plot(coppock, "Coppock", color=color.teal)
plot(trix_val, "TRIX", color=color.yellow)
plot(kst_val, "KST", color=color. blue, display=display. none)
plot(kst_signal, "KST Signal", color=color.orange, display=display. none)
plot(rvi_val, "RVI", color=color. lime, display=display. none)
plot(rvi_signal, "RVI Signal", color=color. red, display=display. none)